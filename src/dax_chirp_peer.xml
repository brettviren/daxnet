<class
    name = "dax_chirp_peer"
    title = "DAX Chirp peer"
    script = "zproto_zyrepeer_c"
    protocol_class = "dax_chirp_msg"
    project_header = "dax_classes.h"
    package_dir = "../include"
    >
  This is the DAX Chirp peer implementation.  It talks to other DAX
  Chirp peers through Zyre.
  
  <state name = "start">
    <event name = "ZYRE_ENTER" next = "start">
      Immediately detects when a node joins and enters them into the
      chat group.  The join action is a built in.
      <action name = "join" group = "CHAT"/>
    </event> 

    <event name = "ZYRE_JOIN" next = "chatting">
      If another node enters send them a hello.  The ingest and send
      actions are built-in.  The ingest action will cause the message
      to be sent down the actor's msgpipe.  User code MUST recv or
      eventually HWM may be reached.
      <action name = "ingest"/>
      <action name = "send" cast = "shout" group = "CHAT" message = "HELLO"/>
    </event>
  </state>
  
  <state name = "chatting">
    
    <event name = "HELLO">
      A new peer is shouting hello to the group whisper back to them a
      world message
      <action name = "send" cast = "whisper" message = "WORLD"/>
    </event>
    <event name = "WORLD">
      A peer is welcoming another peer to the network
      <action name = "send" cast = "whisper" message = "PLEASE CHAT"/>
    </event>

    <event name = "PLEASE CHAT">
      The client is requesting a chat message, package it up and shout it out
      <action name = "generate chat message"/>
    </event>
    <event name = "CHAT">
      Another peer has sent a chat message, output the contents to the user 
      <action name = "output chat message"/>
    </event>

    <event name = "ZYRE_ENTER">
      Another peer has entered. 
      <action name = "output chat message"/>
    </event>

    <event name = "ZYRE_JOIN">
      Another peer joined entered. 
      <action name = "output chat message"/>
    </event>
  </state>

  <method name = "please chat">
    Client interface for sending a PLEASE_CHAT message into the state
    machine via the actor's command pipe.
    <field name = "message" type = "string" />
  </method>


</class>
